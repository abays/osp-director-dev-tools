apiVersion: osp-director.openstack.org/v1beta1
kind: OpenStackControlPlane
metadata:
  name: overcloud
  namespace: {{ namespace }}
spec:
  gitSecret: git-secret
  openStackClientImageURL: {{ openstackclient_image }}
  openStackClientNetworks: {{ openstackclient_networks }}
  openStackClientStorageClass: {{ openstackclient_storage_class }}
  passwordSecret: userpassword
  domainName: {{ ocp_cluster_name }}.{{ ocp_domain_name }}
  virtualMachineRoles:
{% for name, role in osp.vmset.items() %}
{% if role.count > 0 %}
    {{ name }}:
      roleName: {{ name }}
      roleCount: {{ role.count }}
      networks:
{% for net in role.networks %}
        - {{ net }}
{% endfor %}
      cores: {{ role.cores }}
      memory: {{ role.memory }}
      diskSize: {{ role.disk_size }}
      baseImageVolumeName: {{ name|lower }}-base-img
      storageClass: {{ role.storage_class }}
{% endif %}
{% endfor %}
  enableFencing: {{ enable_fencing }}
{% if osp.release == "train" %}
  # for upstream train release the image URLs are different, force the release via parameter
  openStackRelease: {{ osp.release }}
{% endif %}
